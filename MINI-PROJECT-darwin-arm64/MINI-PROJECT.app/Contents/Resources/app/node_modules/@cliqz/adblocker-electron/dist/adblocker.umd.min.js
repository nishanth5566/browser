!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("electron"),require("tldts-experimental"),require("@cliqz/adblocker"),require("node:module")):"function"==typeof define&&define.amd?define(["exports","electron","tldts-experimental","@cliqz/adblocker","node:module"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).adblocker={},e.electron,e.tldtsExperimental,e.adblocker,e.node_module)}(this,(function(e,t,s,r,o){"use strict";var i="undefined"!=typeof document?document.currentScript:null;function n(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(s){if("default"!==s){var r=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return e[s]}})}})),t.default=e,Object.freeze(t)}var l=n(t);const c=o.createRequire("undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:i&&"SCRIPT"===i.tagName.toUpperCase()&&i.src||new URL("adblocker.umd.min.js",document.baseURI).href).resolve("@cliqz/adblocker-electron-preload"),{ipcMain:a}=l;function d(e){const{id:t,url:s,resourceType:o,referrer:i,webContentsId:n}=e;return r.Request.fromRawDetails(n?{_originalRequestDetails:e,requestId:`${t}`,sourceUrl:i,tabId:n,type:o||"other",url:s}:{_originalRequestDetails:e,requestId:`${t}`,sourceUrl:i,type:o||"other",url:s})}process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";class u{constructor(e,t){this.session=e,this.blocker=t,this.onBeforeRequest=(e,s)=>t.onBeforeRequest(e,s),this.onGetCosmeticFiltersFirst=(e,s)=>t.onGetCosmeticFiltersFirst(e,s),this.onGetCosmeticFiltersUpdated=(e,s,r)=>t.onGetCosmeticFiltersUpdated(e,s,r),this.onHeadersReceived=(e,s)=>t.onHeadersReceived(e,s),this.onIsMutationObserverEnabled=e=>t.onIsMutationObserverEnabled(e)}enable(){!0===this.blocker.config.loadCosmeticFilters&&(this.session.setPreloads(this.session.getPreloads().concat([c])),a.on("get-cosmetic-filters-first",this.onGetCosmeticFiltersFirst),a.on("get-cosmetic-filters",this.onGetCosmeticFiltersUpdated),a.on("is-mutation-observer-enabled",this.onIsMutationObserverEnabled)),!0===this.blocker.config.loadNetworkFilters&&(this.session.webRequest.onHeadersReceived({urls:["<all_urls>"]},this.onHeadersReceived),this.session.webRequest.onBeforeRequest({urls:["<all_urls>"]},this.onBeforeRequest))}disable(){!0===this.blocker.config.loadNetworkFilters&&(this.session.webRequest.onHeadersReceived(null),this.session.webRequest.onBeforeRequest(null)),!0===this.blocker.config.loadCosmeticFilters&&(this.session.setPreloads(this.session.getPreloads().filter((e=>e!==c))),a.removeListener("get-cosmetic-filters",this.onGetCosmeticFiltersUpdated))}}class f extends r.FiltersEngine{constructor(){super(...arguments),this.contexts=new WeakMap,this.onIsMutationObserverEnabled=e=>{e.returnValue=this.config.enableMutationObserver},this.onGetCosmeticFiltersFirst=(e,t)=>{const r=s.parse(t),o=r.hostname||"",i=r.domain||"",{active:n,styles:l,scripts:c,extended:a}=this.getCosmeticsFilters({domain:i,hostname:o,url:t,getBaseRules:!0,getInjectionRules:!0,getExtendedRules:!0,getRulesFromHostname:!0,getRulesFromDOM:!1,callerContext:{frameId:e.frameId,processId:e.processId}});!1!==n?(this.injectStyles(e.sender,l),e.sender.send("get-cosmetic-filters-response",{active:n,extended:a,styles:""}),e.returnValue=c):e.returnValue=null},this.onGetCosmeticFiltersUpdated=(e,t,r)=>{const o=s.parse(t),i=o.hostname||"",n=o.domain||"",{active:l,styles:c,extended:a}=this.getCosmeticsFilters({domain:n,hostname:i,url:t,classes:r.classes,hrefs:r.hrefs,ids:r.ids,getBaseRules:!1,getInjectionRules:!1,getExtendedRules:!1,getRulesFromHostname:!1,getRulesFromDOM:!0,callerContext:{frameId:e.frameId,processId:e.processId,lifecycle:r.lifecycle}});!1!==l&&(this.injectStyles(e.sender,c),e.sender.send("get-cosmetic-filters-response",{active:l,extended:a,styles:""}))},this.onHeadersReceived=(e,t)=>{const s="content-security-policy",r=[],o=e.responseHeaders||{};if("mainFrame"===e.resourceType||"subFrame"===e.resourceType){const i=this.getCSPDirectives(d(e));if(void 0!==i){r.push(...i.split(";").map((e=>e.trim())));for(const[e,t]of Object.entries(o))e.toLowerCase()===s&&(r.push(...t),delete o[e]);return o[s]=[r.join(";")],void t({responseHeaders:o})}}t({})},this.onBeforeRequest=(e,t)=>{const s=d(e);if(!0===this.config.guessRequestTypeFromUrl&&"other"===s.type&&s.guessTypeOfRequest(),s.isMainFrame())return void t({});const{redirect:r,match:o}=this.match(s);t(r?{redirectURL:r.dataUrl}:o?{cancel:!0}:{})}}enableBlockingInSession(e){let t=this.contexts.get(e);return void 0!==t||(t=new u(e,this),this.contexts.set(e,t),t.enable()),t}disableBlockingInSession(e){const t=this.contexts.get(e);if(void 0===t)throw new Error("Trying to disable blocking which was not enabled");this.contexts.delete(e),t.disable()}isBlockingEnabled(e){return this.contexts.has(e)}injectStyles(e,t){t.length>0&&e.insertCSS(t,{cssOrigin:"user"})}}e.BlockingContext=u,e.ElectronBlocker=f,e.fromElectronDetails=d,Object.keys(r).forEach((function(t){"default"===t||Object.prototype.hasOwnProperty.call(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:function(){return r[t]}})}))}));
//# sourceMappingURL=adblocker.umd.min.js.map
